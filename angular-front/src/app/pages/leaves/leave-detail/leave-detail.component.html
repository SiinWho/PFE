<app-page-breadcrumb pageTitle="Leave Details" />

<div *ngIf="leave" class="space-y-8 pb-12">
  <app-component-card [title]="'Request #' + leave.id">
    <div class="flex flex-col gap-8 md:flex-row md:items-start md:justify-between">
      <div class="space-y-6 flex-1">
        <div class="grid grid-cols-1 gap-y-8 gap-x-4 sm:grid-cols-2">
          <div class="space-y-1">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Employee</p>
            <p class="text-base font-medium text-gray-800 dark:text-white/90">{{ leave.employee }}</p>
          </div>
          <div class="space-y-1">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Leave Type</p>
            <p class="text-base font-medium text-gray-800 dark:text-white/90">{{ leave.type }}</p>
          </div>
          <div class="space-y-1">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Duration</p>
            <p class="text-base font-medium text-gray-800 dark:text-white/90">{{ leave.from | date:'longDate' }} - {{ leave.to | date:'longDate' }}</p>
          </div>
          <div class="space-y-1">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Total Days</p>
            <p class="text-base font-medium text-gray-800 dark:text-white/90">{{ leave.days }}</p>
          </div>
          <div class="space-y-1 col-span-2 text-primary-500">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Status</p>
            <div class="pt-1">
              <app-badge [color]="getStatusColor(leave.status)">
                {{ leave.status }}
              </app-badge>
            </div>
          </div>
          <div class="space-y-1 col-span-2">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Reason</p>
            <p class="text-base text-gray-600 dark:text-gray-400 leading-relaxed">{{ leave.reason }}</p>
          </div>
        </div>
      </div>

      <div class="flex flex-col gap-3 w-full md:w-48">
        <app-button *ngIf="leave.status === 'Pending'" (btnClick)="approve()" size="sm">Approve</app-button>
        <app-button *ngIf="leave.status === 'Pending'" (btnClick)="reject()" variant="outline" size="sm">Reject</app-button>
        <app-button [routerLink]="['/leaves']" variant="outline" size="sm">Back to List</app-button>
      </div>
    </div>
  </app-component-card>

  <app-component-card title="Workflow Progress">
    <div class="relative pl-8 space-y-10 before:absolute before:left-[11px] before:top-2 before:w-[2px] before:h-[calc(100%-16px)] before:bg-gray-100 dark:before:bg-gray-800">
      <div *ngFor="let step of leave.approvalSteps" class="relative">
        <div class="absolute -left-10 top-2 w-6 h-6 rounded-full flex items-center justify-center border-2 border-white dark:border-gray-900 shadow-sm"
             [ngClass]="step.status === 'Approved' ? 'bg-success-500' : 'bg-gray-300'">
          <svg *ngIf="step.status === 'Approved'" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4"><polyline points="20 6 9 17 4 12"></polyline></svg>
        </div>
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <div>
            <h5 class="text-sm font-bold text-gray-800 dark:text-white/90">{{ step.step }}</h5>
            <p class="text-xs text-gray-500">Verified by <span class="font-medium text-primary-500">{{ step.actor }}</span></p>
          </div>
          <div class="text-right">
            <app-badge [color]="getStatusColor(step.status)" size="sm">{{ step.status }}</app-badge>
            <p class="text-[10px] text-gray-400 mt-1">{{ step.date || 'Pending...' }}</p>
          </div>
        </div>
      </div>
      
      <!-- Final Step Pending if applicable -->
      <div *ngIf="leave.status === 'Pending'" class="relative opacity-60">
        <div class="absolute -left-10 top-2 w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center border-2 border-white dark:border-gray-900"></div>
        <h5 class="text-sm font-medium text-gray-400 italic">Next Step: Final Validation</h5>
      </div>
    </div>
  </app-component-card>
</div>
